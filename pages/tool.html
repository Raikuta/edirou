<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ファイル編集ツール - エディろう">
    <title>ツール - エディろう</title>
    <link rel="stylesheet" href="../index.css">
    <style>
        .file-info {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--color-primary-50);
            border-radius: var(--radius-lg);
        }

        .file-info.show {
            display: block;
        }

        .file-info__name {
            font-weight: 600;
            color: var(--color-gray-800);
        }

        .file-info__size {
            color: var(--color-gray-500);
            font-size: var(--font-size-sm);
        }

        .processing {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .processing.show {
            display: block;
        }

        .processing__spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--color-gray-200);
            border-top-color: var(--color-primary-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .download-area {
            display: none;
            text-align: center;
            padding: 2rem;
            background: var(--color-primary-50);
            border-radius: var(--radius-xl);
            margin-top: 1.5rem;
        }

        .download-area.show {
            display: block;
        }

        .result-message {
            padding: 1rem;
            border-radius: var(--radius-lg);
            margin-top: 1rem;
        }

        .result-message.success {
            background: var(--color-primary-100);
            color: var(--color-primary-800);
        }

        .result-message.error {
            background: #fee2e2;
            color: #991b1b;
        }

        /* 直感的なUI用スタイル */
        .dual-slider {
            position: relative;
            width: 100%;
            height: 40px;
            margin-top: 10px;
        }

        .dual-slider input[type="range"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            pointer-events: none;
            -webkit-appearance: none;
            background: none;
            z-index: 2;
        }

        .dual-slider input[type="range"]::-webkit-slider-thumb {
            pointer-events: auto;
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--color-primary-600);
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            margin-top: -10px;
        }

        .slider-track-container {
            position: absolute;
            top: 10px;
            left: 0;
            width: 100%;
            height: 6px;
            background: var(--color-gray-200);
            border-radius: 3px;
            z-index: 1;
        }

        .slider-track-highlight {
            position: absolute;
            top: 0;
            height: 100%;
            background: var(--color-primary-400);
            z-index: 1;
        }

        /* 回転プレビュー */
        .rotate-preview {
            width: 100px;
            height: 100px;
            background: var(--color-gray-100);
            border: 2px dashed var(--color-gray-300);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            transition: transform 0.3s ease;
        }

        /* プレビューエリア */
        .preview-area {
            display: none;
            margin-top: 2rem;
            padding: 1rem;
            background: var(--color-base-bg);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            text-align: center;
        }

        .preview-area.show {
            display: block;
        }

        .preview-media {
            max-width: 100%;
            max-height: 400px;
            margin: 0 auto;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        audio.preview-media {
            width: 100%;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="container header__inner">
            <a href="../index.html" class="header__logo">
                <svg class="header__logo-icon" viewBox="0 0 32 32">
                    <rect x="4" y="4" width="24" height="24" rx="4" fill="currentColor" opacity="0.2" />
                    <path d="M10 16L14 20L22 12" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
                エディろう
            </a>
            <nav class="header__nav">
                <ul class="header__nav-list">
                    <li><a href="video-tools.html" class="header__nav-link">ビデオ</a></li>
                    <li><a href="audio-tools.html" class="header__nav-link">オーディオ</a></li>
                    <li><a href="pdf-tools.html" class="header__nav-link">PDF</a></li>
                    <li><a href="converters.html" class="header__nav-link">コンバーター</a></li>
                </ul>
            </nav>
            <button class="header__menu-btn" id="menu-btn" aria-label="メニュー"><svg viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M3 12h18M3 6h18M3 18h18" stroke-linecap="round" />
                </svg></button>
        </div>
    </header>
    <nav class="mobile-menu" id="mobile-menu">
        <ul class="mobile-menu__list">
            <li><a href="video-tools.html" class="mobile-menu__link">ビデオツール</a></li>
            <li><a href="audio-tools.html" class="mobile-menu__link">オーディオツール</a></li>
            <li><a href="pdf-tools.html" class="mobile-menu__link">PDFツール</a></li>
            <li><a href="converters.html" class="mobile-menu__link">コンバーター</a></li>
        </ul>
    </nav>
    <main class="tool-page">
        <div class="container">
            <nav class="breadcrumb">
                <a href="../index.html" class="breadcrumb__link">ホーム</a>
                <span class="breadcrumb__separator">›</span>
                <a href="#" class="breadcrumb__link" id="category-link">ツール</a>
                <span class="breadcrumb__separator">›</span>
                <span class="breadcrumb__current" id="tool-name">ツール</span>
            </nav>

            <div class="tool-page__header">
                <h1 class="tool-page__title" id="page-title">ツール</h1>
                <p class="tool-page__description" id="page-description">ファイルを編集できます</p>
            </div>

            <div class="tool-page__content">
                <!-- ドロップゾーン -->
                <div class="drop-zone" id="drop-zone">
                    <svg class="drop-zone__icon" viewBox="0 0 64 64" fill="currentColor">
                        <path d="M32 4L20 16h8v20h8V16h8L32 4zM8 52v8h48v-8H8zm0-8h48V36H8v8z" />
                    </svg>
                    <p class="drop-zone__title">ファイルをドロップ</p>
                    <p class="drop-zone__description">または、クリックしてファイルを選択</p>
                    <input type="file" class="drop-zone__input" id="file-input">
                    <button class="btn btn--primary btn--lg" style="margin-top: 1rem;" id="select-btn">ファイルを選択</button>
                </div>

                <!-- ファイル情報 -->
                <div class="file-info" id="file-info">
                    <p class="file-info__name" id="file-name"></p>
                    <p class="file-info__size" id="file-size"></p>
                </div>

                <!-- プレビューエリア (新規追加) -->
                <div class="preview-area" id="preview-area">
                    <h3 style="margin-bottom: 1rem; font-size: 1rem; color: var(--color-gray-600);">プレビュー</h3>
                    <div id="preview-content"></div>
                </div>

                <!-- オプション -->
                <div class="tool-page__options" id="options-panel">
                    <!-- JSで動的に生成 -->
                </div>

                <!-- 処理中 -->
                <div class="processing" id="processing">
                    <div class="processing__spinner"></div>
                    <p>処理中です...</p>
                </div>

                <!-- 結果メッセージ -->
                <div class="result-message" id="result-message"></div>

                <!-- ダウンロードエリア -->
                <div class="download-area" id="download-area">
                    <h3 style="margin-bottom: 1rem;">処理完了！</h3>
                    <button class="btn btn--primary btn--lg" id="download-btn">ダウンロード</button>
                </div>

                <!-- アクション -->
                <div class="tool-page__actions" id="action-buttons">
                    <button class="btn btn--secondary" id="reset-btn">リセット</button>
                    <button class="btn btn--primary btn--lg" id="start-btn" disabled>編集を開始</button>
                </div>
            </div>
        </div>
    </main>
    <footer class="footer">
        <div class="container">
            <div class="footer__bottom">
                <p>&copy; 2026 エディろう</p>
            </div>
        </div>
    </footer>

    <script src="../index.js"></script>
    <script>
        // ツール定義
        const tools = {
            // ビデオツール
            'video-edit': { title: '動画編集', desc: '動画ファイルをブラウザ上で簡単に編集', category: 'video', accept: 'video/*', categoryLink: 'video-tools.html', categoryName: 'ビデオツール' },
            'video-trim': { title: 'トリムビデオ', desc: 'スライダーで直感的に範囲を指定してカット', category: 'video', accept: 'video/*', categoryLink: 'video-tools.html', categoryName: 'ビデオツール' },
            'video-merge': { title: '動画を結合', desc: '複数の動画を1つに結合', category: 'video', accept: 'video/*', categoryLink: 'video-tools.html', categoryName: 'ビデオツール' },
            'video-rotate': { title: '動画を回転', desc: '動画を90度/180度回転', category: 'video', accept: 'video/*', categoryLink: 'video-tools.html', categoryName: 'ビデオツール' },
            'video-resize': { title: 'サイズ変更', desc: '動画の解像度を変更', category: 'video', accept: 'video/*', categoryLink: 'video-tools.html', categoryName: 'ビデオツール' },
            'video-loop': { title: 'ループ動画', desc: '動画をループ再生用に変換', category: 'video', accept: 'video/*', categoryLink: 'video-tools.html', categoryName: 'ビデオツール' },
            'screen-record': { title: '画面録画', desc: 'ブラウザで画面を録画', category: 'video', accept: '', categoryLink: 'video-tools.html', categoryName: 'ビデオツール' },
            // オーディオツール
            'audio-trim': { title: 'オーディオのトリム', desc: '波形を見ながら音声範囲を選択（シミュレーション）', category: 'audio', accept: 'audio/*', categoryLink: 'audio-tools.html', categoryName: 'オーディオツール' },
            'audio-volume': { title: '音量変更', desc: 'スライダーで音量を直感的に調整', category: 'audio', accept: 'audio/*', categoryLink: 'audio-tools.html', categoryName: 'オーディオツール' },
            'audio-speed': { title: '再生速度変更', desc: '音声の再生速度を変更', category: 'audio', accept: 'audio/*', categoryLink: 'audio-tools.html', categoryName: 'オーディオツール' },
            'audio-merge': { title: 'オーディオのマージ', desc: '複数の音声ファイルを結合', category: 'audio', accept: 'audio/*', categoryLink: 'audio-tools.html', categoryName: 'オーディオツール' },
            // PDFツール
            'pdf-split': { title: 'PDF 分割', desc: 'PDFを複数のファイルに分割', category: 'pdf', accept: '.pdf', categoryLink: 'pdf-tools.html', categoryName: 'PDFツール' },
            'pdf-merge': { title: 'PDF 結合', desc: '複数のPDFを1つに結合', category: 'pdf', accept: '.pdf', categoryLink: 'pdf-tools.html', categoryName: 'PDFツール' },
            'pdf-compress': { title: 'PDF 圧縮', desc: 'PDFのファイルサイズを削減', category: 'pdf', accept: '.pdf', categoryLink: 'pdf-tools.html', categoryName: 'PDFツール' },
            'pdf-to-jpg': { title: 'PDF → JPG', desc: 'PDFを画像に変換', category: 'pdf', accept: '.pdf', categoryLink: 'pdf-tools.html', categoryName: 'PDFツール' },
            // コンバーター
            'convert-mp4': { title: 'MP4 変換', desc: '動画をMP4形式に変換', category: 'converter', accept: 'video/*', categoryLink: 'converters.html', categoryName: 'コンバーター' },
            'convert-mp3': { title: 'MP3 変換', desc: '音声をMP3形式に変換', category: 'converter', accept: 'audio/*', categoryLink: 'converters.html', categoryName: 'コンバーター' },
            'convert-jpg': { title: 'JPG 変換', desc: '画像をJPG形式に変換', category: 'converter', accept: 'image/*', categoryLink: 'converters.html', categoryName: 'コンバーター' },
            'convert-png': { title: 'PNG 変換', desc: '画像をPNG形式に変換', category: 'converter', accept: 'image/*', categoryLink: 'converters.html', categoryName: 'コンバーター' },
        };

        // URLパラメータからツールIDを取得
        const params = new URLSearchParams(window.location.search);
        const toolId = params.get('tool') || 'video-edit';
        const tool = tools[toolId] || tools['video-edit'];

        // ページ情報を更新
        document.getElementById('page-title').textContent = tool.title;
        document.getElementById('page-description').textContent = tool.desc;
        document.getElementById('tool-name').textContent = tool.title;
        document.getElementById('category-link').textContent = tool.categoryName;
        document.getElementById('category-link').href = tool.categoryLink;
        document.title = tool.title + ' - エディろう';

        // ファイル入力のaccept属性を設定
        if (tool.accept) {
            document.getElementById('file-input').accept = tool.accept;
        }

        // ツールごとのオプション生成
        const optionsPanel = document.getElementById('options-panel');
        let optionsHtml = '';

        // スライダー更新用の関数
        window.updateDualSlider = function () {
            const slider1 = document.getElementById('slider-1');
            const slider2 = document.getElementById('slider-2');
            const track = document.getElementById('slider-track');
            const displayStart = document.getElementById('display-start');
            const displayEnd = document.getElementById('display-end');

            if (!slider1 || !slider2) return;

            const minVal = Math.min(parseInt(slider1.value), parseInt(slider2.value));
            const maxVal = Math.max(parseInt(slider1.value), parseInt(slider2.value));

            // 100%ベースで計算
            track.style.left = minVal + "%";
            track.style.width = (maxVal - minVal) + "%";

            // 値の表示更新 (秒数シミュレーション: 全体60秒として計算)
            const totalDuration = 60;
            const startSec = (minVal / 100 * totalDuration).toFixed(1);
            const endSec = (maxVal / 100 * totalDuration).toFixed(1);

            displayStart.value = startSec;
            displayEnd.value = endSec;
        }

        // 回転更新用
        let currentRotation = 0;
        window.updateRotation = function (deg) {
            currentRotation = (currentRotation + deg) % 360;
            if (currentRotation < 0) currentRotation += 360; // Keep positive
            const preview = document.getElementById('rotate-preview-icon');
            if (preview) {
                preview.style.transform = `rotate(${currentRotation}deg)`;
            }
            document.getElementById('rotation-value').textContent = currentRotation + '°';
        }

        // リサイズスケール更新用
        window.updateResizeScale = function (val) {
            const widthInput = document.getElementById('width');
            const heightInput = document.getElementById('height');

            // 基準サイズ 1920x1080 とする
            const baseW = 1920;
            const baseH = 1080;

            const scale = val / 100;
            widthInput.value = Math.round(baseW * scale);
            heightInput.value = Math.round(baseH * scale);
            document.getElementById('scale-val').textContent = val + '%';
        }

        switch (toolId) {
            // --- ビデオツール ---
            case 'video-trim':
            case 'audio-trim':
                optionsHtml = `
          <h3 class="tool-page__options-title">トリミング設定</h3>
          <p style="margin-bottom: 0.5rem; color: var(--color-gray-600);">バーをスライドして範囲を選択してください</p>
          
          <div class="dual-slider">
             <div class="slider-track-container">
                 <div class="slider-track-highlight" id="slider-track" style="left: 0%; width: 100%;"></div>
             </div>
             <input type="range" min="0" max="100" value="0" id="slider-1" oninput="updateDualSlider()">
             <input type="range" min="0" max="100" value="100" id="slider-2" oninput="updateDualSlider()">
          </div>
          
          <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <div class="form-group" style="flex: 1;">
              <label class="form-label">開始 (秒)</label>
              <input type="number" class="form-input" id="display-start" value="0.0" readonly style="background: var(--color-gray-50);">
            </div>
            <div class="form-group" style="flex: 1;">
              <label class="form-label">終了 (秒)</label>
              <input type="number" class="form-input" id="display-end" value="60.0" readonly style="background: var(--color-gray-50);">
            </div>
          </div>
        `;
                break;

            case 'video-resize':
                optionsHtml = `
          <h3 class="tool-page__options-title">リサイズ設定</h3>
          
          <div class="form-group">
            <label class="form-label">縮小率: <span id="scale-val">100%</span></label>
            <input type="range" min="10" max="100" value="100" step="10" oninput="updateResizeScale(this.value)" style="width: 100%;">
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--color-gray-500);">
               <span>10%</span>
               <span>50%</span>
               <span>100%</span>
            </div>
          </div>

          <div style="display: flex; gap: 1rem; align-items: flex-end;">
            <div class="form-group" style="flex: 1;">
              <label class="form-label" for="width">幅 (px)</label>
              <input type="number" class="form-input" id="width" value="1920">
            </div>
            <div style="padding-bottom: 1rem;">×</div>
            <div class="form-group" style="flex: 1;">
              <label class="form-label" for="height">高さ (px)</label>
              <input type="number" class="form-input" id="height" value="1080">
            </div>
          </div>
        `;
                break;

            case 'video-rotate':
            case 'pdf-rotate':
                optionsHtml = `
          <h3 class="tool-page__options-title">回転設定</h3>
          
          <!-- プレビューアイコン -->
          <div class="rotate-preview">
             <svg id="rotate-preview-icon" viewBox="0 0 24 24" width="48" height="48" fill="currentColor" style="transition: transform 0.3s;">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                <text x="12" y="16" font-size="6" text-anchor="middle" fill="currentColor" style="display:none">TOP</text>
             </svg>
          </div>
          <p style="text-align:center; margin-bottom: 1rem; font-weight:bold;">現在の回転: <span id="rotation-value">0°</span></p>

          <div class="form-group">
            <div style="display: flex; gap: 1rem;">
              <button class="btn btn--outline" style="flex: 1;" onclick="updateRotation(90)">↷ 90° 右へ</button>
              <button class="btn btn--outline" style="flex: 1;" onclick="updateRotation(-90)">↶ 90° 左へ</button>
            </div>
          </div>
        `;
                break;

            case 'audio-volume':
            case 'video-volume':
                optionsHtml = `
          <h3 class="tool-page__options-title">音量設定</h3>
          <div class="form-group">
            <label class="form-label" for="volume">音量レベル: <span id="volume-val">100</span>%</label>
            <input type="range" id="volume" min="0" max="200" value="100" style="width: 100%;">
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--color-gray-500);">
              <span>ミュート</span>
              <span>100% (標準)</span>
              <span>200% (2倍)</span>
            </div>
          </div>
        `;
                break;

            case 'audio-speed':
            case 'video-speed':
                optionsHtml = `
          <h3 class="tool-page__options-title">再生速度設定</h3>
          <div class="form-group">
            <label class="form-label" for="speed">速度: <span id="speed-val">1.0</span>x</label>
            <input type="range" id="speed" min="0.5" max="2.0" step="0.25" value="1.0" style="width: 100%;">
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--color-gray-500);">
              <span>0.5x (遅く)</span>
              <span>1.0x (標準)</span>
              <span>2.0x (速く)</span>
            </div>
          </div>
        `;
                break;

            default:
                // 既存のデフォルトロジック（そのまま維持）
                if (tool.category === 'audio' || tool.category === 'converter' && tool.accept.includes('audio')) {
                    optionsHtml = `
            <h3 class="tool-page__options-title">変換オプション</h3>
            <div class="form-group">
                <label class="form-label" for="bitrate">ビットレート</label>
                <select class="form-select" id="bitrate">
                <option value="320">320 kbps (高品質)</option>
                <option value="256">256 kbps</option>
                <option value="192" selected>192 kbps (標準)</option>
                <option value="128">128 kbps</option>
                </select>
            </div>
            `;
                } else if (tool.category === 'pdf') {
                    optionsHtml = `
            <h3 class="tool-page__options-title">PDFオプション</h3>
             <div class="form-group">
               <label class="form-label" for="pages">ページ範囲</label>
               <input type="text" class="form-input" id="pages" placeholder="例: 1-5, 8, 10-12">
             </div>
            `;
                } else if (tool.category === 'converter') {
                    optionsHtml = `
          <h3 class="tool-page__options-title">変換オプション</h3>
          <div class="form-group">
            <label class="form-label" for="format">出力形式</label>
            <select class="form-select" id="format">
              <option value="mp4" ${toolId.includes('mp4') ? 'selected' : ''}>MP4</option>
              <option value="webm" ${toolId.includes('webm') ? 'selected' : ''}>WebM</option>
              <option value="mov" ${toolId.includes('mov') ? 'selected' : ''}>MOV</option>
              <option value="jpg" ${toolId.includes('jpg') ? 'selected' : ''}>JPG</option>
              <option value="png" ${toolId.includes('png') ? 'selected' : ''}>PNG</option>
            </select>
          </div>
        `;
                } else {
                    optionsHtml = `
            <h3 class="tool-page__options-title">編集オプション</h3>
            <p style="color: var(--color-gray-500);">このツールには設定は不要です。</p>
            `;
                }
        }

        // オプションパネルにHTMLを設定
        optionsPanel.innerHTML = optionsHtml;

        // スライダーの値表示更新 (volume, speed用)
        const volumeSlider = document.getElementById('volume');
        if (volumeSlider) {
            volumeSlider.addEventListener('input', (e) => {
                document.getElementById('volume-val').textContent = e.target.value;
            });
        }
        const speedSlider = document.getElementById('speed');
        if (speedSlider) {
            speedSlider.addEventListener('input', (e) => {
                document.getElementById('speed-val').textContent = e.target.value;
            });
        }
        // 初期ロード時にデュアルスライダーを更新
        if (toolId === 'video-trim' || toolId === 'audio-trim') {
            window.updateDualSlider();
        }


        // ファイル選択
        let selectedFile = null;
        const fileInput = document.getElementById('file-input');
        const dropZone = document.getElementById('drop-zone');
        const fileInfo = document.getElementById('file-info');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const processing = document.getElementById('processing');
        const downloadArea = document.getElementById('download-area');
        const resultMessage = document.getElementById('result-message');
        const selectBtn = document.getElementById('select-btn');

        selectBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            selectedFile = file;
            document.getElementById('file-name').textContent = file.name;
            document.getElementById('file-size').textContent = formatSize(file.size);
            fileInfo.classList.add('show');
            startBtn.disabled = false;
            resultMessage.className = 'result-message';
            resultMessage.textContent = '';
            downloadArea.classList.remove('show');

            // プレビュー生成
            showPreview(file);
        }

        function showPreview(file) {
            const previewArea = document.getElementById('preview-area');
            const previewContent = document.getElementById('preview-content');
            previewContent.innerHTML = ''; // クリア
            previewArea.classList.remove('show');

            const fileType = file.type;
            const objectUrl = URL.createObjectURL(file);

            let previewElement = null;

            if (fileType.startsWith('video/')) {
                previewElement = document.createElement('video');
                previewElement.controls = true;
                previewElement.src = objectUrl;
                previewElement.className = 'preview-media';
            } else if (fileType.startsWith('audio/')) {
                previewElement = document.createElement('audio');
                previewElement.controls = true;
                previewElement.src = objectUrl;
                previewElement.className = 'preview-media';
            } else if (fileType.startsWith('image/')) {
                previewElement = document.createElement('img');
                previewElement.src = objectUrl;
                previewElement.className = 'preview-media';
            } else if (fileType === 'application/pdf') {
                previewElement = document.createElement('iframe');
                previewElement.src = objectUrl;
                previewElement.className = 'preview-media';
                previewElement.style.width = '100%';
                previewElement.style.height = '500px';
            }

            if (previewElement) {
                previewContent.appendChild(previewElement);
                previewArea.classList.add('show');
            }
        }

        function formatSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 編集開始
        startBtn.addEventListener('click', () => {
            if (!selectedFile) {
                resultMessage.className = 'result-message error';
                resultMessage.textContent = 'ファイルを選択してください';
                return;
            }

            // 処理中表示
            processing.classList.add('show');
            startBtn.disabled = true;
            resultMessage.className = 'result-message';
            resultMessage.textContent = '';

            // 模擬処理（実際の処理はWebAssembly/FFmpegで実装）
            setTimeout(() => {
                processing.classList.remove('show');
                resultMessage.className = 'result-message success';
                resultMessage.textContent = '処理が完了しました！';
                downloadArea.classList.add('show');
                startBtn.disabled = false;
            }, 2000);
        });

        // ダウンロード
        document.getElementById('download-btn').addEventListener('click', () => {
            if (selectedFile) {
                // 実際の処理済みファイルをダウンロード（デモでは元ファイル）
                const url = URL.createObjectURL(selectedFile);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'edited_' + selectedFile.name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        });

        // リセット
        resetBtn.addEventListener('click', () => {
            selectedFile = null;
            fileInput.value = '';
            fileInfo.classList.remove('show');
            document.getElementById('preview-area').classList.remove('show');
            document.getElementById('preview-content').innerHTML = '';
            startBtn.disabled = true;
            processing.classList.remove('show');
            downloadArea.classList.remove('show');
            resultMessage.className = 'result-message';
            resultMessage.textContent = '';
        });
    </script>
</body>

</html>